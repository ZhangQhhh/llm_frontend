<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>管理员端 - Exam-RAG</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:20px}
  .card{border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-bottom:16px;background:#fff}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  input[type=file],input[type=text],input[type=password],select{
    padding:8px;
    border:1px solid #e5e7eb;
    border-radius:8px;
    font:14px/1.4 "Segoe UI",Roboto,Arial,sans-serif;
    box-sizing:border-box;
  }
  button{
    padding:8px 14px;
    border-radius:8px;
    border:1px solid #11182720;
    cursor:pointer;
    background:#f9fafb;
    white-space:nowrap;
    font:14px/1.4 "Segoe UI",Roboto,Arial,sans-serif;
  }
  button:disabled{opacity:.6;cursor:not-allowed}
  .muted{color:#6b7280}
  .q{padding:10px;background:#f9fafb;border-radius:8px;margin-bottom:8px}
  .opt label{display:block;margin:6px 0}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px}
  .pill.gray{background:#f3f4f6;color:#374151}
  .pill.green{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
  .pill.red{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
  .pill.yellow{background:#fff7ed;color:#92400e;border:1px solid #fed7aa}
  .pill.orange{background:#fff4e5;color:#9a3412;border:1px solid #fdba74} /* 新增：异常 */
  .analysis{white-space:pre-wrap;background:#fff;border:1px dashed #e5e7eb;padding:8px;border-radius:8px;margin-top:8px}
  .editor textarea{width:100%;min-height:140px;padding:8px;border:1px solid #e5e7eb;border-radius:8px;font:14px/1.5 ui-monospace,Consolas,monospace}

  .pw-grid { display:grid; grid-template-columns:220px 220px 150px; justify-content:start; align-items:center; gap:10px; }
  #ru { border:1px solid #e5e7eb; border-radius:8px; height:38px; font:14px/1.4 "Segoe UI",Roboto,Arial,sans-serif; box-sizing:border-box; padding:8px; width:220px; background:#fff; }
</style>
</head>
<body>
  <h1>管理员端</h1>
  <div class="muted" id="who"></div>
  <div class="row"><a href="./login.html">退出/切换账号</a></div>

  <div class="card">
    <h3>用户密码</h3>
    <div class="pw-grid" style="margin-bottom:8px;">
      <input id="oldp" type="password" placeholder="旧密码"/>
      <input id="newp" type="password" placeholder="新密码"/>
      <button id="btnChange">修改我的密码</button>
    </div>
    <div class="pw-grid">
      <input id="ru" type="text" placeholder="用户名"/>
      <input id="rp" type="password" placeholder="新密码"/>
      <button id="btnReset">重置他人密码</button>
    </div>
  </div>

  <div class="card">
    <h3>1) 上传题目文档（.docx）</h3>
    <div class="row">
      <input type="file" id="qfile" accept=".docx"/>
      <button id="btnUpload">上传并解析题目</button>
      <span id="uploadMsg" class="muted"></span>
      <button id="btnDownloadTemplate" class="btn">下载导入模板</button>
    </div>
  </div>

  <div class="card">
    <h3>2) 生成解析草稿（RAG / Qwen）</h3>
    <div class="row">
      <button id="btnExplain">批量生成解析草稿</button>
      <span id="expMsg" class="muted"></span>
    </div>
  </div>

  <div class="card">
    <h3>3) 题库（审核通过/驳回/编辑）</h3>
    <div class="row">
      <button id="btnLoad">刷新题库</button>
      <button id="btnExportTeacher">导出教师版题库 DOCX</button>
      <input type="file" id="importTeacherFile" accept=".docx"/>
      <button id="btnImportTeacher">导入教师版 DOCX</button>
      <!-- ✅ 仅新增：一键通过 -->
      <button id="btnApproveAll" type="button">一键通过</button>
      <!-- ✅ 新增：状态筛选 -->
      <label for="statusFilter" class="muted">筛选：</label>
      <select id="statusFilter">
        <option value="all">全部</option>
        <option value="approved">通过</option>
        <option value="draft">草稿</option>
        <option value="abnormal">异常</option>
      </select>
    </div>
    <div id="qList"></div>
  </div>

  <div class="card">
    <h3>4) 生成试卷（并导出学生版）</h3>
    <div class="row">
      <input type="text" id="paperTitle" value="概率统计小测"/>
      <button id="btnCreatePaper">生成试卷</button>
      <span id="paperMsg" class="muted"></span>
    </div>
  </div>

  <div class="card">
    <h3>5) 按试卷导出成绩</h3>
    <div class="row">
      <label>选择试卷：
        <select id="paperZipSelect"></select>
      </label>
      <button id="btnExportZip">导出成绩 ZIP（每人一份）</button>
      <button id="btnExportDocx">导出成绩表 DOCX（汇总表）</button>
      <span class="muted" id="zipMsg"></span>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const btnDownloadTemplate = document.getElementById('btnDownloadTemplate');
    if(btnDownloadTemplate){
      btnDownloadTemplate.onclick = ()=>{
        window.open('/admin/import_template/public_file','_blank');
      };
    }
  });
  </script>
  <script src="./admin_app.js"></script>
</body>
</html>
