# 前端分组权限接入说明

## 1. 概念说明
- **角色体系（已有）**：`USER / ADMIN / SUPER_ADMIN`，不变。
- **分组权限（新增）**：普通用户的页面访问通过权限码控制；管理员不受分组限制。
- **后端最终拦截**：前端只做展示控制，接口访问仍由后端校验。

## 1.1 什么是“权限点/权限码”
- **权限点**：一个可被授权的“访问能力”，例如“访问某个页面”或“调用某个接口”。
- **权限码**：权限点的唯一编号（字符串），前后端用它做统一判断。
- **常见写法**：
  - 页面编号：`PAGE_001`、`PAGE_010`
  - 功能权限：`PERM_FEEDBACK_VIEW`
- **原则**：前端页面不要用“页面名称”当权限判断，统一用权限码。

## 2. 登录与鉴权
- 登录接口：
  - `POST /api/user/account/token/`
- 取到 token 后，所有接口带：
  - `Authorization: Bearer <token>`

## 3. 权限码约定
- 统一使用**后端定义的权限码**，不要直接用“页面名”。
- 建议格式：
  - 页面权限：`PAGE_001`、`PAGE_010`
  - 功能权限：`PERM_业务_动作`，例如 `PERM_FEEDBACK_VIEW`

## 4. 前端页面/路由绑定方式
在路由或菜单配置里绑定权限码，例如：
```js
{
  path: '/feedback',
  name: '反馈管理',
  requiredPerms: ['PAGE_010', 'PERM_FEEDBACK_VIEW']
}
```
展示逻辑建议：
- **ADMIN / SUPER_ADMIN**：直接放行显示。
- **普通用户**：若权限列表包含 `requiredPerms` 中任一项则显示。

## 5. 当前已生效的权限点
以下接口需要 `PERM_FEEDBACK_VIEW`：
- `GET /api/feedback/show/{id}`
- `GET /api/feedback/show/list`
- `GET /api/feedback/show/page`

## 6. 管理端（SUPER_ADMIN）接口
用于后台配置分组与权限、用户归组：

### 6.1 新建分组
`POST /api/admin/groups`
```json
{ "name": "反馈查看组", "remark": "仅可看反馈", "status": 1 }
```
分组名称来源：管理端页面填写的 `name` 字段，后端原样保存到数据库。

### 6.2 分组权限覆盖设置
`PUT /api/admin/groups/{groupId}/permissions`
```json
{ "permissions": ["PERM_FEEDBACK_VIEW"] }
```

### 6.3 用户分组覆盖设置
`PUT /api/admin/groups/users/{userId}`
```json
{ "groupIds": [1, 3] }
```

## 7. 权限获取与页面检测
### 7.1 获取当前用户权限列表
`GET /api/user/permissions`

返回示例：
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "permissions": ["PAGE_001", "PERM_FEEDBACK_VIEW"],
    "roles": ["ROLE_USER"],
    "isAdmin": false
  }
}
```

### 7.2 页面编号检测
`GET /api/permission/check?code=PAGE_001`

返回示例：
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "allowed": true,
    "code": "PAGE_001",
    "permissions": ["PAGE_001", "PERM_FEEDBACK_VIEW"],
    "roles": ["ROLE_USER"],
    "isAdmin": false
  }
}
```

### 7.3 前端使用建议
- 页面进入时先调用 `GET /api/permission/check?code=页面编号` 决定是否放行。
- 或登录后先拉 `GET /api/user/permissions` 缓存权限，再本地判断路由展示。

## 8. 常见问题
- **权限点是什么意思？**  
  权限点就是一个“可授权的访问能力”，比如“访问某个页面”或“调用某个接口”。它用权限码表示，分组里保存的就是这些权限码。
- **分组名称是谁写进数据库的？**  
  是管理端页面提交的 `name` 字段，后端原样存库。
