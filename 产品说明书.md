# 皖美智脑 - 企业级智能问答系统产品说明书

> **版本**: v1.0.0  
> **发布日期**: 2025年12月  
> **作者**: zq  
> **邮箱**: hi@zqsee.com  

---

# 第一部分：系统功能

---
## 一、功能模块详解

本章节详细介绍“皖美智脑”系统的各项功能模块，并结合边检站的实际业务场景说明每个模块可以解决什么问题、适用于哪些场合，便于一线民警和管理人员按需查阅。

---

## 核心功能

### 功能一：智能问答系统

智能问答是“皖美智脑”的核心功能，用户可以通过自然语言提问，系统会从知识库中检索相关信息，并生成专业、准确的回答。

#### 1.1 功能特点

| 特点 | 说明 | 用户价值 |
|-----|:----:|---------|
| **语义理解** | 理解用户问题的真实意图，而非简单关键词匹配 | 问法灵活，不必拘泥于特定表述 |
| **多源检索** | 从多个知识库中综合检索相关信息 | 答案更全面，覆盖多个维度 |
| **智能排序** | 对检索结果进行智能重排序，优先展示最相关内容 | 答案更精准，减少无关信息 |
| **实时响应** | 流式输出，边生成边显示 | 无需等待，体验流畅 |
| **来源可追溯** | 显示答案的参考来源和相关性分数 | 可验证，增强信任 |

#### 1.2 问答模式

**模式一：单轮问答**

适用于独立问题，每次提问都是全新的对话。

**使用场景**：

在日常工作中，民警可以通过单轮问答快速查询某项政策或规定，例如某类边检证件的办理依据、特定国家出入境的最新要求等，减少翻阅纸质文件的时间。

当需要搞清楚一个完整的业务流程时（例如证件补办、现场移交、异常情况上报等），可以直接用自然语言询问“某个流程的具体步骤”，系统会按照步骤顺序给出清晰的操作指引。

对于单一知识点的理解性问题，比如对某个专业术语、某条条款含义不够确定，也可以通过单轮问答获取更加通俗易懂的解释，辅助新警学习和老同志回顾。

**示例**：
```
用户：边检证件过期后如何处理？

系统：根据相关规定，边检证件过期后的处理流程如下：
1. 首先需要到户籍所在地公安机关申请补办
2. 准备以下材料：身份证、户口本、2寸照片
3. 填写《边检证件申请表》
4. 缴纳工本费
5. 等待审批，一般需要7-15个工作日

【参考来源】边检证件管理规定.pdf (相关度: 95%)
```

**模式二：多轮对话**

适用于需要深入探讨的复杂问题，系统会记住对话上下文。

**使用场景**：

当民警需要围绕某个业务主题持续追问时（例如“某国落地签政策的适用情形”“特定人群的通关注意事项”），可以在同一会话中分多次提问，系统会自动理解前后关联，帮助逐步梳理完整的业务脉络。

在办理具体个案时，如果前一轮已经获取了总体流程，后续还需要进一步了解“需要准备哪些材料”“对特殊情况如何处理”“是否有例外情形”等细节问题，也可以继续在原会话中提问，系统会结合已有上下文给出更精确的回答。

对于需要根据前文内容做延伸讨论的场景，例如先了解一般规定，再询问“针对我们边检站有什么特别要求”“是否有近期的最新通知”，多轮对话可以帮助民警在同一上下文中完成从宏观到细节的完整咨询过程。

**示例**：
```
用户：日本免签政策是什么？
系统：日本对中国公民实行有条件免签政策...

用户：那需要准备什么材料？
系统：（理解"那"指的是日本免签）您需要准备以下材料...

用户：有效期是多久？
系统：（理解上下文）日本免签的有效期为...
```                           

#### 1.3 思考模式

思考模式是“皖美智脑”提供的一项扩展功能，开启后系统会展示较为完整的推理过程，便于用户理解答案是如何得出的。

**思考模式输出示例**：

```
【咨询解析】
用户询问边检证件过期后的处理流程，这是一个关于证件管理的政策咨询问题。
需要从知识库中检索证件管理相关规定和办理流程。

【信息检索】
从知识库中找到以下相关信息：
- 边检证件管理规定.pdf：包含证件过期处理的详细规定
- 证件办理流程指南.docx：包含具体办理步骤
- 常见问题解答.txt：包含材料清单

【逻辑推理】
根据检索到的信息，边检证件过期后需要：
1. 确认过期时间（超过6个月需重新申请）
2. 准备必要材料
3. 到指定地点办理

【综合解答】
根据相关规定，边检证件过期后的处理流程如下...
```

**思考模式的价值**：
- **透明可信**：用户可以看到答案的推理过程
- **便于验证**：可以核对检索到的信息来源
- **辅助学习**：了解问题分析的思路和方法
- **问题排查**：如果答案有误，可以定位问题环节

#### 1.4 多知识库智能路由

系统支持多个专业知识库，会根据问题类型自动选择最相关的知识库组合。

**知识库类型**：

| 知识库 | 内容范围 | 适用问题 |
|-------|---------|---------|
| **通用知识库** | 基础业务知识、通用规定 | 一般性业务咨询 |
| **免签知识库** | 各国免签政策、签证规定 | 免签、签证相关问题 |
| **航司知识库** | 航空公司规定、机组人员政策 | 航司、机组相关问题 |

**智能路由示例**：

| 用户问题 | 识别意图 | 检索知识库 |
|---------|---------|-----------|
| "护照办理需要什么材料？" | 通用问题 | 通用知识库 |
| "日本免签政策是什么？" | 免签问题 | 免签库 + 通用库 |
| "机组人员入境有什么特殊规定？" | 航司问题 | 航司库 + 通用库 |
| "日本免签对机组人员有特殊要求吗？" | 组合问题 | 三库联合检索 |

#### 1.5 参考来源展示

每个回答都会附带参考来源信息，包括：

| 信息项 | 说明 |
|-------|------|
| **文档标题** | 参考文档的名称 |
| **相关性分数** | 0-1之间的分数，越高越相关 |
| **知识库来源** | 来自哪个知识库（通用/免签/航司） |
| **内容片段** | 相关的文档片段预览 |

**来源展示示例**：
```
【参考来源】
1. 边检证件管理规定.pdf (相关度: 95%) - 通用知识库
   "边检证件过期后，持证人应在30日内到户籍所在地..."
   
2. 证件办理指南.docx (相关度: 88%) - 通用知识库
   "办理边检证件需准备以下材料：1.身份证原件..."
```

---

### 功能二：多轮对话管理

多轮对话功能让用户可以与系统进行连续的对话，系统会记住对话历史，理解上下文关系。

#### 2.1 会话管理

**创建会话**

每次开始新的对话主题时，需要创建一个新会话。系统会生成唯一的会话ID。

**会话列表**

用户可以查看自己的所有会话，包括：
- 会话标题（自动从第一条消息生成）
- 创建时间
- 最后更新时间
- 消息数量

**会话历史**

可以查看某个会话的完整对话历史
#### 2.2 上下文理解

系统会智能理解对话上下文，处理以下情况：

| 情况 | 示例 | 系统处理 |
|-----|------|---------|
| **代词指代** | "它的有效期是多久？" | 理解"它"指前文提到的证件 |
| **省略主语** | "需要什么材料？" | 理解是在问前文话题的材料 |
| **追问细节** | "具体流程呢？" | 理解是在追问前文提到的事项 |
| **话题延续** | "还有其他注意事项吗？" | 理解是在继续前文话题 |

#### 2.3 对话历史压缩

对于长对话，系统会智能压缩历史信息：

| 对话轮数 | 处理策略 |
|---------|---------|
| 1-6轮 | 保留完整对话历史 |
| 7-12轮 | 最近6轮完整 + 早期轮次摘要 |
| 12轮以上 | 生成整体摘要 + 最近6轮完整 |

这样既保证了上下文理解的准确性，又避免了过长历史导致的性能问题。

---

### 功能三：写作助手

写作助手帮助用户快速生成各类文档内容，支持多种写作风格和模板。

#### 3.1 功能特点

| 特点 | 说明 |
|-----|------|
| **多风格支持** | 正式、休闲、学术等多种写作风格 |
| **长度可控** | 可指定生成内容的目标字数 |
| **模板识别** | 自动识别上传文档的结构和模板 |
| **参考文档** | 可上传参考文档，基于参考内容生成 |
| **思考模式** | 展示写作思路和构思过程 |

#### 3.2 使用流程

**步骤一：创建写作会话**
```
系统自动生成会话ID，用于管理本次写作任务
```

**步骤二：上传参考文档（可选）**
```
支持上传最多10个参考文档
支持格式：txt, md, pdf, docx
单个文件最大：20MB
```

**步骤三：输入写作指令**
```
示例指令：
- "写一篇关于人工智能发展的报告，1000字左右，正式风格"
- "根据上传的模板，生成一份工作总结"
- "将这篇文章改写成学术论文风格"
```

**步骤四：获取生成内容**
```
系统流式输出生成内容
可以继续对话，要求修改或补充
```

#### 3.3 写作风格

| 风格 | 特点 | 适用场景 |
|-----|------|---------|
| **正式 (formal)** | 用语规范、结构严谨、措辞专业 | 公文、报告、通知 |
| **休闲 (casual)** | 语言轻松、表达自然、亲和力强 | 博客、社交媒体、日常沟通 |
| **学术 (academic)** | 逻辑严密、引用规范、论证充分 | 论文、研究报告、学术文章 |

#### 3.4 模板识别

上传文档后，系统可以自动识别：
- **文档大纲**：识别文档的章节结构
- **占位符**：识别需要填写的字段
- **写作建议**：根据模板给出写作建议

---

### 功能四：题库管理系统

题库管理系统提供完整的题目管理、试卷生成和在线考试功能。

#### 4.1 题目管理

**支持的题型**：
- 单选题
- 多选题
- 判断题

**题目属性**：

| 属性 | 说明 |
|-----|------|
| **题目内容** | 题目的文字描述 |
| **选项** | A/B/C/D等选项内容 |
| **正确答案** | 标准答案 |
| **分类标签** | 所属知识点或类别 |
| **解析说明** | 答案解析和知识点说明 |

**批量操作**：
- **批量导入**：支持从 DOCX 文件批量导入题目
- **批量导出**：支持导出为 DOCX 格式
- **批量编辑**：支持批量修改题目属性
- **批量删除**：支持批量删除（进入回收站）

**智能解析**：
- 上传题目文件后，系统自动解析题目结构
- 支持 LLM 智能格式化，处理格式不规范的题目
- 自动生成题目解析说明

#### 4.2 试卷管理

**生成试卷**：
- 按分类选题（如：单选x题、多选x题）
- 按数量限制（如：总共50题）
- 随机抽题或指定题目

**试卷操作**：
- 预览试卷内容
- 编辑试卷题目
- 导出试卷（DOCX格式）
- 导出试卷+答案（ZIP包）

#### 4.3 在线考试

**考试流程**：

```
1. 管理员发布试卷 → 设置考试时间、时长
2. 学生进入考试 → 系统记录开始时间
3. 学生答题 → 实时保存答案
4. 提交试卷 → 自动判分
5. 查看成绩 → 查看答案解析
```

**考试功能**：

| 功能 | 说明 |
|-----|------|
| **计时功能** | 显示剩余时间，到时自动提交 |
| **自动判分** | 提交后立即显示成绩 |
| **答案解析** | 查看每题的正确答案和解析 |
| **错题回顾** | 查看答错的题目 |

#### 4.4 成绩管理

**学生端**：
- 查看自己的考试成绩
- 查看答题详情和解析
- 导出个人成绩报告（DOCX）

**管理员端**：
- 查看所有学生成绩
- 成绩统计分析（平均分、及格率等）
- 导出班级成绩汇总（DOCX）
- 批量导出成绩报告（ZIP）

#### 4.5 回收站功能

删除的题目会进入回收站，支持：
- 查看已删除题目
- 永久删除
- 清空回收站

---

### 功能五：数据分析系统

数据分析系统帮助管理员了解系统使用情况，优化知识库内容。

#### 5.1 问答统计

| 统计维度 | 说明 |
|---------|------|
| **问答数量** | 每日/每周/每月的问答总量 |
| **用户分布** | 不同用户的使用情况 |

#### 5.2 日志查询

**查询维度**：
- 按日期查询
- 按用户查询
- 按关键词搜索

**日志内容**：
- 用户问题
- 系统回答
- 检索来源
- 响应时间
- 用户反馈

#### 5.3 知识库分析

| 分析项 | 说明 |
|-------|------|
| **文档使用率** | 各文档被引用的频率 |
| **检索效果** | 检索结果的相关性分数分布 |
| **覆盖率分析** | 哪些问题没有找到相关文档 |
| **更新建议** | 建议补充或更新的知识点 |

---

### 功能六：知识库管理

知识库管理功能让管理员可以维护和更新知识库内容。

#### 6.1 文档上传

**支持的格式**：
- 文本文件：txt, md
- Office文档：docx, doc
- PDF文档：pdf
- 数据文件：csv, json
- 网页文件：html, htm

**文件限制**：
- 单个文件最大：50MB
- 支持批量上传

**上传流程**：
```
1. 选择目标知识库（通用/免签/航司等）
2. 上传文件
3. 系统自动解析文档
4. 构建向量索引
5. 知识库更新完成
```

#### 6.2 知识库类型

| 知识库 | 用途 | 配置开关 |
|-------|------|---------|
| **通用知识库** | 基础业务知识 | 默认开启 |
| **免签知识库** | 免签政策专用 | ENABLE_VISA_FREE_FEATURE |
| **航司知识库** | 航司规定专用 | ENABLE_AIRLINE_FEATURE |
| **通用知识库B** | 扩展知识库 | ENABLE_GENERAL_KB_B |

#### 6.3 状态监控

可以查看各知识库的状态：

| 状态 | 说明 |
|-----|------|
| **ready** | 就绪，可正常使用 |
| **updating** | 更新中，暂时不可用 |
| **error** | 出错，需要检查 |

状态信息包括：
- 文档数量
- 最后更新时间
- 更新进度（更新中时）

#### 6.4 文件管理

- **查看文件列表**：查看知识库中的所有文件
- **删除文件**：删除指定文件（需要密码）
- **重建索引**：手动触发知识库重建

---
# 第二部分：使用指南

---
## 二、界面总览

从用户登录系统开始，“皖美智脑”提供了一个统一的 Web 门户入口。登录成功后，首先看到的是设计为大屏沉浸式风格的首页，该页面以科幻感背景、动态粒子和网格光效作为视觉基底，在中央显著位置展示系统名称“皖美智脑”以及一句简短的功能定位说明。首页中部区域布置了一组功能入口按钮，用户可以直接点击进入“业务问答”“智能对话”“边检智学”“公文助手”“12367 助手”“数研报告”等核心模块，无需记忆复杂菜单路径；右侧还通过悬浮卡片的形式突出展示了常用的“数研报告”“公文助手”“边检智学”等高频功能，方便一线民警快速跳转到对应业务场景。

在“业务问答（知识问答）”页面中，界面采用居中的大输入区设计，上方是具有科技感的 AI 背景和品牌区，中央为多行文本输入框，用户可以直接输入自然语言问题。输入区下方集中放置了模型选择、参考文档数量、精准检索、思考模式、选择题模式等开关选项，便于在同一界面内完成参数调整。问题提交后，左侧主区域以卡片形式流式展示 AI 回答和可折叠的“思考过程”，右侧或下方则以列表/标签形式呈现参考文献、关键词提取和问题分解结果，让用户在阅读答案的同时可以快速验证依据和追溯出处。

“多轮对话”页面更接近常见聊天工具的布局，左侧是会话列表栏，用于浏览、切换和新建会话，支持分页和按更新时间排序；右侧上方为模型和检索相关配置，下方是时间顺序排列的对话消息区域，用户与 AI 的对话采用左右分栏气泡样式展示。每轮 AI 回答内部又细分为“思考过程”“正式回答”“关键词提取”等子块，其中思考过程支持折叠/展开，既便于在排查问题时查看完整推理链条，又不会干扰日常快速阅读。参考来源则以可折叠侧边栏的形式集中呈现，包含初始得分、重排序得分、向量/BM25 评分和匹配关键词等信息，便于管理人员进行检索效果分析。

“边检智学（题库与考试系统）”页面围绕考试作答流程进行布局，顶部工具栏提供试卷选择、考试时长设置、开始作答按钮以及倒计时展示，并在右侧显示当前登录用户信息和密码修改入口。页面左侧是题目导航区，以数字按钮网格显示整份试卷的题号和作答状态，支持一键跳转到任意题目；右侧主区域按页分段展示题目内容和选项，单选、多选题的不同状态通过按钮样式和颜色进行区分。交卷后，下方会依次出现成绩概览、错题统计与知识点分析、答案与解析等模块，用户既可以直观查看整体分数和正确率，也可以通过高亮和知识点统计快速定位薄弱环节，并在同一页面回顾每道题的正确答案、本人作答及详细解析。

“数研报告（数据分析）”页面则以卡片式布局引导用户完成报表生成流程。页面上方通过图标和标题说明该模块用于对往年与今年的 Excel 数据进行对比分析，中部提供两个拖拽上传区域分别接收“往年数据”和“今年数据”文件，系统在上传时自动校验文件格式并在不符合要求时引导用户前往 Excel 工具进行格式转换。用户完成文件选择后，只需点击“开始分析”按钮，系统会在后台调用大模型生成结构化的 Word 报告，并在浏览器中自动下载生成结果；页面底部的流程步骤图和注意事项段落，用连续文字配合图示的方式，帮助使用者一次性理解整个“上传—分析—下载”的完整链路。

除上述业务模块外，系统还提供“用户仪表盘”“管理中心”“超级管理员中心”等管理类页面，用于支持日常运维和权限管理。“用户仪表盘”从统计卡片、排行榜和数据表三个层次展示当前系统用户规模、状态分布、近 7 天问答活跃情况等信息，并配合筛选条件和分页组件，方便管理员按状态、角色快速筛选并导出用户数据；“管理中心”聚合了账号审核、密码管理、题库管理、试卷管理、成绩导出等工具，在单页多标签的布局中串联起从题库建设到考试运维的完整后台流程；“超级管理员中心”则以卡片+表格的形式提供账号审核、创建管理员、查看管理员列表、提升/降级管理员和重置密码等高权限操作，并在页面显著位置以提示文字和时间轴段落强调操作风险和推荐流程。通过这些前端界面的统一设计和清晰分工，“皖美智脑”将复杂的智能问答、学习评测和数据分析能力，组织成一组一线民警和管理人员都可以直观理解、快速上手的业务入口。

## 三、快速入门

本章节从登录入口、问题提问、多轮对话和考试练习等几个常用场景出发，帮助用户快速上手使用“皖美智脑”系统。

### 3.1 访问系统

本系统通过浏览器访问，无需安装客户端。普通用户只需要记住登录入口并完成账号登录，无需关注认证方式、请求头等技术细节。

**访问与登录**

1. 打开常用浏览器（推荐使用最新版 Chrome、Edge 等），输入管理员提供的系统地址，进入“皖美智脑”首页。
2. 在登录页面中输入管理员分配的用户名和密码，点击“登录”按钮。
3. 如果是首次登录或密码已过期，系统会根据页面提示要求修改密码，按照提示完成修改后即可正常使用各项功能。

### 3.2 智能问答快速开始

#### 第一步：进入问答页面

在首页点击“业务问答”按钮，或通过顶部导航栏选择“知识问答”模块，进入知识问答页面。

#### 第二步：输入问题

在输入框中输入您的问题，例如：
```
边检证件过期后如何处理？
```

#### 第三步：选择问答模式

| 选项 | 说明 | 建议 |
|-----|------|------|
| **思考模式** | 开启后显示推理过程 | 需要了解答案来源时开启 |
| **模型选择** | 选择使用的AI模型 | 一般使用默认模型即可 |

#### 第四步：获取回答

点击发送后，系统会：
1. 分析您的问题意图
2. 从知识库检索相关信息
3. 生成专业回答
4. 显示参考来源

#### 第五步：继续对话（可选）

如果需要追问，直接输入后续问题：
```
那需要准备什么材料？
```

### 3.3 多轮对话使用指南

#### 创建新会话

1. 点击"新建会话"按钮
2. 系统生成唯一会话ID
3. 开始您的对话

#### 查看历史会话

1. 点击"会话列表"
2. 选择要查看的会话
3. 查看完整对话历史

#### 继续之前的对话

1. 从会话列表选择会话
2. 系统自动加载对话历史
3. 继续输入新问题

#### 清空会话

1. 选择要清空的会话
2. 点击"清空"按钮
3. 确认清空操作

### 3.4 写作助手使用指南

#### 基本写作

1. 从首页或导航菜单进入“写作助手”页面（如管理员已启用该功能）
2. 输入写作指令，例如：
   ```
   写一篇关于人工智能发展的报告，1000字左右
   ```
3. 等待系统生成内容
4. 根据需要继续修改或补充

#### 基于模板写作

1. 上传模板文档
2. 系统自动识别模板结构
3. 输入写作指令：
   ```
   根据上传的模板，生成一份工作总结
   ```
4. 系统按模板格式生成内容

#### 基于参考文档写作

1. 上传参考文档（最多10个）
2. 输入写作指令：
   ```
   根据上传的资料，写一份综合报告
   ```
3. 系统参考文档内容生成

### 3.5 题库系统使用指南

#### 学生端使用

**参加考试**：
1. 从首页点击“边检智学”按钮，或在导航栏选择“边检智学/考试”页面
2. 选择可用的试卷
3. 点击"开始考试"
4. 答题（注意剩余时间）
5. 点击"提交试卷"
6. 查看成绩和解析

**查看成绩**：
1. 进入成绩页面
2. 查看考试成绩列表
3. 点击查看详情
4. 可导出成绩报告

#### 管理员端使用

**上传题目**：
1. 进入题库管理页面
2. 点击"上传题目"
3. 选择题目文件（DOCX格式）
4. 系统自动解析题目
5. 确认并保存

**生成试卷**：
1. 点击"生成试卷"
2. 设置试卷参数：
   - 试卷名称
   - 题目数量
3. 点击生成
4. 预览并发布

**查看成绩**：
1. 选择试卷
2. 查看所有学生成绩
3. 可导出成绩汇总

---
## 四、操作手册

本章节提供详细的操作步骤说明。

### 4.1 智能问答操作

#### 4.1.1 单轮问答

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 访问问答页面 | 从首页点击“业务问答”按钮，或通过顶部导航栏选择“知识问答”模块 |
| 2 | 输入问题 | 在输入框输入您的问题 |
| 3 | 选择选项 | 是否开启思考模式、选择模型 |
| 4 | 点击发送 | 或按 Enter 键 |
| 5 | 等待回答 | 系统流式输出回答内容 |
| 6 | 查看来源 | 回答末尾显示参考来源 |

**参数说明**：

| 参数 | 类型 | 默认值 | 说明 |
|-----|------|-------|------|
| question | 文本 | 必填 | 您的问题内容 |
| thinking | 开关 | 关闭 | 是否显示思考过程 |
| model_id | 选择 | qwen3-32b | 使用的AI模型 |
| rerank_top_n | 数字 | 10 | 参考文档数量 |

#### 4.1.2 多轮对话

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 访问对话页面 | 从首页点击“多轮对话”按钮，或通过顶部导航栏选择“多轮对话”模块 |
| 2 | 创建新会话 | 点击"新建会话"按钮 |
| 3 | 输入第一个问题 | 开始对话 |
| 4 | 继续追问 | 输入后续问题，系统理解上下文 |
| 5 | 查看历史 | 可随时查看对话历史 |
| 6 | 结束对话 | 可清空或保留会话 |

**会话管理操作**：

| 操作 | 说明 |
|-----|------|
| 新建会话 | 开始新的对话主题 |
| 查看列表 | 查看所有历史会话 |
| 查看历史 | 查看某个会话的完整对话 |
| 清空会话 | 清除会话中的所有消息 |
| 删除会话 | 永久删除会话 |

### 4.2 知识库管理操作

知识库文档的上传、状态查看和删除等操作，普通用户无需在此手册中掌握具体步骤。

### 4.3 题库管理操作

#### 4.3.1 上传题目

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 准备题目文件 | DOCX格式，按模板格式 |
| 2 | 进入上传界面 | 以管理员身份登录系统，在“管理中心”中切换到“题库管理”标签，找到“上传题目”区域 |
| 3 | 选择文件 | 点击“选择文件/上传题目”按钮，选择准备好的题目文件 |
| 4 | 点击上传 | 点击“上传/解析”按钮，系统自动解析题目内容 |
| 5 | 确认解析结果 | 在界面中检查题目是否被正确解析，必要时手动修正 |
| 6 | 保存到题库 | 确认无误后点击“保存到题库” |

**题目文件格式**：
```
1. 以下哪个是Python的特点？
A. 编译型语言
B. 解释型语言
C. 汇编语言
D. 机器语言
答案：B

2. HTTP协议默认端口是？
A. 21
B. 22
C. 80
D. 443
答案：C
```

#### 4.3.2 生成试卷

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 访问试卷管理 | `/mcq_public/bank/papers` |
| 2 | 点击生成试卷 | 进入生成页面 |
| 3 | 设置试卷名称 | 输入试卷标题 |
| 4 | 设置题目数量 | 指定题目数量 |
| 5 | 点击生成 | 系统随机抽题 |
| 6 | 预览试卷 | 检查试卷内容 |
| 7 | 发布试卷 | 发布后学生可见 |

#### 4.3.3 管理考试

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 选择试卷 | 从试卷列表选择 |
| 2 | 设置考试时间 | 开始时间、时长 |
| 3 | 发布考试 | 学生可以开始考试 |
| 4 | 查看成绩 | 考试结束后查看成绩 |
| 5 | 导出报告 | 导出成绩汇总 |

### 4.4 写作助手操作

#### 4.4.1 基本写作

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 访问写作页面 | `/writer/` |
| 2 | 创建写作会话 | 系统自动创建 |
| 3 | 输入写作指令 | 描述您的写作需求 |
| 4 | 点击生成 | 系统开始生成 |
| 5 | 查看结果 | 流式显示生成内容 |
| 6 | 继续修改 | 可以要求修改或补充 |

**写作指令示例**：

| 场景 | 指令示例 |
|-----|---------|
| 写报告 | "写一篇关于人工智能发展的报告，1000字左右，正式风格" |
| 写总结 | "根据上传的资料，写一份工作总结" |
| 改写 | "将这篇文章改写成学术论文风格" |
| 扩写 | "将这段内容扩展到500字" |

#### 4.4.2 上传参考文档

**操作步骤**：

| 步骤 | 操作 | 说明 |
|-----|------|------|
| 1 | 点击上传按钮 | 进入上传界面 |
| 2 | 选择文件 | 最多10个文件 |
| 3 | 确认上传 | 等待上传完成 |
| 4 | 查看文件列表 | 确认文件已上传 |
| 5 | 开始写作 | 系统会参考上传的文档 |

---
## 五、常见问题解答

### 5.1 智能问答相关

#### Q1：为什么系统回答"知识库中未找到相关信息"？

**可能原因**：
1. 知识库中确实没有相关内容
2. 问题表述与知识库内容差异较大
3. 知识库正在更新中

**解决方法**：
1. 尝试换一种方式提问
2. 使用更具体的关键词
3. 等待知识库更新完成
4. 联系管理员补充相关知识

#### Q2：回答内容不够准确怎么办？

**可能原因**：
1. 问题表述不够清晰
2. 知识库内容需要更新
3. 检索到的信息不够相关

**解决方法**：
1. 提供更多背景信息
2. 使用更精确的表述
3. 开启思考模式查看检索来源
4. 反馈给管理员优化知识库

#### Q3：为什么回答速度较慢？

**可能原因**：
1. 问题较复杂，需要检索多个知识库
2. 开启了思考模式
3. 网络延迟
4. 服务器负载较高

**解决方法**：
1. 简化问题
2. 关闭思考模式
3. 检查网络连接
4. 稍后重试

#### Q4：多轮对话中系统没有理解上下文？

**可能原因**：
1. 会话已过期或被清空
2. 问题表述过于模糊
3. 话题跳转过大

**解决方法**：
1. 检查是否在同一会话中
2. 在问题中明确指代对象
3. 适当重复关键信息

### 5.2 知识库相关

#### Q5：上传文档后为什么没有生效？

**可能原因**：
1. 知识库正在重建中
2. 文档格式不支持
3. 文档内容为空或无法解析

**解决方法**：
1. 等待知识库重建完成
2. 检查文档格式是否支持
3. 检查文档内容是否正常

#### Q6：支持哪些文档格式？

**支持的格式**：
- 文本文件：txt, md
- Office文档：docx, doc
- PDF文档：pdf
- 数据文件：csv, json
- 网页文件：html, htm

**文件限制**：
- 单个文件最大：50MB
- 建议使用 txt 或 md 格式，解析效果最好

#### Q7：如何知道知识库更新完成？

**查看方法**：
1. 在知识库管理界面查看各知识库的状态信息
2. 当状态显示 `ready` 时，表示更新完成，可正常使用
3. 如果长时间停留在 `updating` 或出现 `error` 状态，请联系系统管理员排查

### 5.3 题库相关

#### Q8：上传的题目解析不正确怎么办？

**可能原因**：
1. 题目格式不规范
2. 选项格式不统一
3. 答案标记不清晰

**解决方法**：
1. 按照模板格式整理题目
2. 使用 LLM 智能格式化功能
3. 手动修正解析结果

### 5.4 写作助手相关

#### Q9：生成的内容不符合要求怎么办？

**解决方法**：
1. 提供更详细的写作指令
2. 指定具体的风格和格式
3. 上传参考文档或模板
4. 继续对话要求修改

#### Q10：如何让生成内容更专业？

**建议**：
1. 提供专业术语和背景
2. 上传专业参考文档
3. 明确指出专业要求

### 5.5 系统相关

#### Q11：系统提示"服务不可用"怎么办？

**可能原因**：
1. 知识库正在更新
2. 服务器维护中
3. 网络连接问题

**解决方法**：
1. 等待几分钟后重试
2. 检查网络连接
3. 联系管理员确认服务状态

#### Q12：如何开通系统访问权限？

**获取方式**：
1. 联系系统管理员，说明您的单位和使用需求
2. 由管理员为您开通账号或授权访问权限
3. 收到用户名和初始密码后，按“快速入门”中的步骤登录系统，并按提示修改密码

#### Q13：登录时提示“未授权”或“认证过期”怎么办？

**解决方法**：
1. 先尝试退出并重新登录系统
2. 若多次重试仍无法登录，请联系系统管理员检查账号是否已被停用或权限是否过期
3. 如管理员为您调整了权限或重置了密码，请根据新的账号信息重新登录

---
## 六、产品规格

### 6.1 系统要求

| 项目 | 最低要求 | 推荐配置 |
|------|---------|----------|
| **操作系统** | Linux / macOS / Windows | Linux (Ubuntu 20.04+) |
| **Python版本** | 3.10+ | 3.10 / 3.11 |
| **内存** | 8GB | 16GB+ |
| **存储** | 10GB | 50GB+ SSD |
| **CPU** | 4核 | 8核+ |
| **GPU** | 可选 | NPU/GPU支持 |

### 6.2 性能指标

| 指标 | 数值 | 说明 |
|------|------|------|
| **并发用户** | 100+ | 支持高并发访问 |
| **平均响应时间** | <2秒 | 问答平均响应时间 |
| **检索精度** | >90% | BGE重排序后的相关性 |
| **系统可用性** | 99.9% | 系统稳定性保障 |
| **知识库容量** | 100万+ | 支持的文档数量 |
| **单文件大小** | 50MB | 最大上传文件大小 |

### 6.3 功能规格

| 功能模块 | 规格说明 |
|---------|---------|
| **知识库数量** | 支持多种知识库（通用、免签、航司、扩展） |
| **支持文档格式** | txt, md, pdf, docx, doc, csv, json, html |
| **多轮对话轮数** | 无限制（自动压缩历史） |
| **写作参考文档** | 最多10个文件 |
| **题库题目数量** | 无限制 |
| **试卷题目数量** | 可自定义 |
| **考试时长** | 可自定义 |

### 6.4 技术规格

| 技术组件 | 规格说明 |
|---------|---------|
| **向量维度** | 1024维（BGE-Large-zh-v1.5） |
| **检索算法** | 向量检索 + BM25 + RRF融合 |
| **重排序模型** | BGE-Reranker-Large |
| **LLM支持** | Qwen、ChatGLM、DeepSeek等 |
| **流式输出** | SSE (Server-Sent Events) |
| **认证方式** | Bearer Token |

---
# 第三部分：接口文档

---
## 七、API接口说明

本章节提供主要 API 接口的使用说明，帮助系统开发和运维人员集成、调试与“皖美智脑”相关的功能。一般业务用户（如一线民警）可直接跳过本章节，无需关注其中技术细节。

### 7.1 接口概述

**基础信息**：

| 项目 | 说明 |
|-----|------|
| **Base URL** | `http://53.3.1.2:5000` |
| **认证方式** | `Authorization: Bearer <token>` |
| **字符编码** | UTF-8 |
| **响应格式** | JSON / SSE |

**通用请求头**：
```
Authorization: Bearer <your_token>
Content-Type: application/json
```

### 7.2 知识问答接口

#### 7.2.1 单轮问答

**接口地址**：`POST /api/knowledge_chat`

**请求参数**：

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|-------|------|
| question | string | 是 | - | 用户问题 |
| thinking | boolean | 否 | false | 是否开启思考模式 |
| model_id | string | 否 | qwen3-32b | 使用的模型 |
| rerank_top_n | integer | 否 | 10 | 参考文档数量 |
| user_id | string | 否 | - | 用户ID |

**请求示例**：
```json
{
    "question": "边检证件过期后如何处理？",
    "thinking": true,
    "model_id": "qwen3-32b",
    "rerank_top_n": 10
}
```

**响应格式**：SSE流式响应

```
THINK:【咨询解析】用户询问边检证件过期流程...
CONTENT:根据相关规定，边检证件过期后...
SOURCE:{"title":"边检管理规定","score":0.95,"kb_source":"general"}
DONE:
```

**响应消息类型**：

| 类型 | 说明 |
|-----|------|
| `THINK:` | 思考过程内容 |
| `CONTENT:` | 正文回答内容 |
| `SOURCE:` | 参考来源（JSON格式） |
| `DONE:` | 结束标记 |
| `ERROR:` | 错误信息 |

#### 7.2.2 多轮对话

**接口地址**：`POST /api/knowledge_chat_conversation`

**请求参数**：

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|-------|------|
| question | string | 是 | - | 用户问题 |
| session_id | string | 是 | - | 会话ID |
| thinking | boolean | 否 | true | 是否开启思考模式 |
| model_id | string | 否 | qwen3-32b | 使用的模型 |
| rerank_top_n | integer | 否 | 10 | 参考文档数量 |

**请求示例**：
```json
{
    "question": "那需要准备什么材料？",
    "session_id": "550e8400-e29b-41d4-a716-446655440000",
    "thinking": false
}
```

#### 7.2.3 创建会话

**接口地址**：`POST /api/conversation/new`

**响应示例**：
```json
{
    "session_id": "550e8400-e29b-41d4-a716-446655440000",
    "message": "新会话创建成功"
}
```

#### 7.2.4 获取会话列表

**接口地址**：`POST /api/conversation/sessions/list`

**请求参数**：

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|-------|------|
| page | integer | 否 | 1 | 页码 |
| page_size | integer | 否 | 20 | 每页数量 |
| sort_by | string | 否 | last_update | 排序字段 |

**响应示例**：
```json
{
    "type": "success",
    "data": {
        "total": 50,
        "sessions": [
            {
                "session_id": "uuid",
                "title": "关于护照办理的咨询",
                "message_count": 5,
                "create_time": "2025-01-20T10:30:00",
                "last_update_time": "2025-01-20T11:00:00"
            }
        ]
    }
}
```

#### 7.2.5 获取会话历史

**接口地址**：`POST /api/conversation/sessions/{session_id}/history`

**请求参数**：

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|-----|------|-----|-------|------|
| limit | integer | 否 | 50 | 返回数量 |
| offset | integer | 否 | 0 | 偏移量 |
| order | string | 否 | asc | 排序方式 |

### 7.3 知识库管理接口

#### 7.3.1 上传文档

**接口地址**：`POST /api/knowledge/upload`

**请求头**：
```
Authorization: Bearer <token>
X-KB-PASSWORD: <upload_password>
Content-Type: multipart/form-data
```

**表单参数**：

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| file | file | 是 | 上传的文件 |
| kb | string | 否 | 知识库类型（general/visa_free/airline） |
| auto_rebuild | boolean | 否 | 是否自动重建索引 |

**响应示例**：
```json
{
    "ok": true,
    "message": "已接收，开始重建",
    "file_name": "document.pdf",
    "kb_type": "general"
}
```

#### 7.3.2 查看状态

**接口地址**：`GET /api/knowledge/update_status`

**响应示例**：
```json
{
    "general": {
        "name": "通用知识库",
        "status": "ready",
        "document_count": 1500,
        "last_updated": "2025-01-20 10:30:00"
    },
    "visa_free": {
        "name": "免签知识库",
        "status": "updating",
        "progress": 45
    }
}
```

#### 7.3.3 列出文件

**接口地址**：`GET /api/knowledge/list_files`

**查询参数**：

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| kb | string | 是 | 知识库类型 |

### 7.4 写作助手接口

#### 7.4.1 创建写作会话

**接口地址**：`POST /api/writer/session/new`

**响应示例**：
```json
{
    "session_id": "uuid_string"
}
```

#### 7.4.2 上传参考文档

**接口地址**：`POST /api/writer/upload`

**表单参数**：

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| session_id | string | 是 | 会话ID |
| files | file[] | 是 | 文件列表（最多10个） |

#### 7.4.3 流式写作

**接口地址**：`POST /api/writer/chat`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| session_id | string | 是 | 会话ID |
| instruction | string | 是 | 写作指令 |
| style | string | 否 | 写作风格 |
| enable_thinking | boolean | 否 | 是否显示思考过程 |
| use_kb | boolean | 否 | 是否使用知识库 |

### 7.5 题库管理接口

#### 7.5.1 上传题目

**接口地址**：`POST /mcq_public/upload`

**表单参数**：

| 参数 | 类型 | 必填 | 说明 |
|-----|------|-----|------|
| file | file | 是 | 题目文件（DOCX格式） |

**响应示例**：
```json
{
    "ok": true,
    "items": [
        {
            "question": "Python是什么类型的语言？",
            "options": ["编译型", "解释型", "汇编", "机器"],
            "answer": "B"
        }
    ],
    "count": 50
}
```

#### 7.5.2 获取题库列表

**接口地址**：`GET /mcq_public/bank/list`

#### 7.5.3 生成试卷

**接口地址**：`POST /mcq_public/bank/generate_paper`

**请求参数**：
```json
{
    "name": "试卷名称"
}
```

#### 7.5.4 开始考试

**接口地址**：`POST /mcq_public/exam/start`

**请求参数**：
```json
{
    "paper_id": "试卷ID",
    "duration_sec": 1800,
    "student_id": "学生ID"
}
```

#### 7.5.5 提交答案

**接口地址**：`POST /mcq_public/exam/submit`

**请求参数**：
```json
{
    "attempt_id": "考试记录ID",
    "answers": [
        {"question_id": "题目ID", "selected": "A"}
    ]
}
```

### 7.6 错误码说明

| HTTP状态码 | 说明 |
|-----------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未认证或Token无效 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 503 | 服务不可用（知识库更新中） |

**错误响应格式**：
```json
{
    "type": "error",
    "content": "错误描述信息"
}
```

---

# 第五部分：附录

---

## 九、附录

### 附录A：术语表

| 术语 | 英文 | 说明 |
|-----|------|------|
| **RAG** | Retrieval-Augmented Generation | 检索增强生成，结合检索和生成的AI技术 |
| **LLM** | Large Language Model | 大语言模型 |
| **向量检索** | Vector Search | 基于语义相似度的检索方式 |
| **BM25** | Best Matching 25 | 经典的关键词检索算法 |
| **RRF** | Reciprocal Rank Fusion | 倒数排名融合算法 |
| **重排序** | Reranking | 对检索结果进行精细排序 |
| **SSE** | Server-Sent Events | 服务器推送事件，用于流式输出 |
| **Token** | - | 文本的基本单位，用于认证或计量 |
| **Embedding** | - | 文本的向量表示 |
| **知识库** | Knowledge Base | 存储知识文档的数据库 |

### 附录B：快捷键

| 快捷键 | 功能 |
|-------|------|
| Enter | 发送消息 |
| Shift + Enter | 换行 |
| Ctrl + C | 复制内容 |
| Ctrl + V | 粘贴内容 |

### 附录C：文件格式要求

#### 知识库文档格式

**推荐格式**：
- **txt**：纯文本，解析效果最好
- **md**：Markdown格式，支持结构化内容

**支持格式**：
- **docx/doc**：Word文档
- **pdf**：PDF文档
- **csv**：表格数据
- **json**：结构化数据
- **html**：网页内容

**格式建议**：
1. 使用UTF-8编码
2. 避免过多格式装饰
3. 保持内容结构清晰
4. 单个文件不超过50MB

#### 题目文件格式

**标准格式**：
```
1. 题目内容
A. 选项A
B. 选项B
C. 选项C
D. 选项D
答案：B

2. 题目内容
A. 选项A
B. 选项B
C. 选项C
D. 选项D
答案：C
```

**格式要求**：
1. 题目编号使用数字+点号
2. 选项使用大写字母+点号
3. 答案单独一行，格式为"答案：X"
4. 题目之间用空行分隔

### 附录D：配置参数说明

#### 功能开关

| 参数 | 默认值 | 说明 |
|-----|-------|------|
| ENABLE_INTENT_CLASSIFIER | false | 启用意图分类器 |
| ENABLE_VISA_FREE_FEATURE | false | 启用免签知识库 |
| ENABLE_AIRLINE_FEATURE | false | 启用航司知识库 |
| ENABLE_GENERAL_KB_B | false | 启用通用知识库B |

#### 检索参数

| 参数 | 默认值 | 说明 |
|-----|-------|------|
| RETRIEVAL_TOP_K | 30 | 初步检索数量 |
| RERANK_TOP_N | 10 | 重排序后返回数量 |
| RRF_K | 5.0 | RRF融合参数 |
| RRF_VECTOR_WEIGHT | 0.7 | 向量检索权重 |
| RRF_BM25_WEIGHT | 0.3 | BM25检索权重 |

#### LLM参数

| 参数 | 默认值 | 说明 |
|-----|-------|------|
| DEFAULT_LLM_ID | qwen3-32b | 默认使用的模型 |
| LLM_MAX_TOKENS | 4000 | 最大生成Token数 |
| LLM_REQUEST_TIMEOUT | 60 | 请求超时时间（秒） |

### 附录E：版本历史

| 版本 | 日期 | 更新内容 |
|-----|------|---------|
| v1.0.0 | 2025-01 | 初始版本发布 |
| v1.1.0 | 2025-01 | 新增多轮对话、写作助手 |
| v1.2.0 | 2025-02 | 新增题库管理、考试系统 |
| v1.3.0 | 2025-03 | 新增数据分析、日志查询 |

### 附录F：联系方式

---

**文档版本**: v1.0.0  
**最后更新**: 2025年12月  
**作者**: zq  
**邮箱**: hi@zqsee.com

---

**感谢您使用“皖美智脑”智能问答系统！**
